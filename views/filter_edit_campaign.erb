<%
err = []
begin
    # map parameters
    gid = params[:gid]
    name = params[:name]
    id_export = params[:id_export]

    # validate: the name is not empty
    err << "Name is required." if name.empty?

    # validate: the id_export is not empty
    err << "Export is required." if id_export.empty?

    # if any error happened, return to the edition screen
    raise err.join("\n") if err.size > 0

    # load, edit and save the campaign
    o = BlackStack::Emails::Campaign.where(:id=>gid).first
    o.name = name
    o.id_export = id_export
    o.save

    # return
    redirect "/emails/campaigns/#{o.id.to_guid}/edit?msg="+ CGI::escape('Campaign updated.')
rescue => e
    # return errors
    redirect "/emails/campaigns/#{params[:gid].to_guid}/edit?err="+ CGI::escape(e.message)
end
%>